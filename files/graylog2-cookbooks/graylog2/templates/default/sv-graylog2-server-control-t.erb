#!/bin/bash

count=0
count_by=5
let kwait=20

pid=`pgrep -f graylog2-server.jar`

if [ -z "$pid" ]; then
  echo "Service not running"
  exit 0
else
  kill -TERM $pid
  until [ `ps -p $pid | grep -c $pid` = '0' ] || [ $count -gt $kwait ]; do
    echo "Waiting for processes to exit. Timeout before we kill the pid: ${count}/${kwait}"
    sleep $count_by
    let count=$count+$count_by;
  done

  if [ $count -gt $kwait ]; then
    echo "Killing processes which didn't stop after $kwait seconds"
    kill -KILL $pid
  fi
fi
exit 0
